<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Install Haproxy Lets Encrypt &middot; The Issue of the Day Before</title>
  <link rel="stylesheet" href="/css/azure.css" />
  <link rel="stylesheet" href="/css/asciidoctor-default.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <style type="text/css">
  </style>
</head>

<body class="normalize">
  <header class="header">
    
    <a class="title" href="/">The Issue of the Day Before</a>
  </header>
  <nav class="main-nav">
    
    
    
  </nav>
  <article class="main gridpaper container">
    




  <article class="li-article">
    <header class="li-article-header">
      <h1 class="li-article-title">讓 HAProxy 也可以 Let&#39;s Encrypt</h1>
      <span class="li-article-taxonomies">
        

        
      </span>
      
      <time class="li-article-date">2018-08-23</time>
    </header>
    <section class="section">
      <div class="paragraph">
<p>越來越多的服務要求使用 <code>https</code>, 在網路上混的 <code>HAProxy</code> 當然也要聲援一下.
<code>HAProxy</code> 自從 <code>1.5</code> 版後就支援 <code>SSL</code>. 但每次到期要手動申請 <code>renew</code> 也是一項不人性的作業.
不出意外, 只要有這種長時間後才要重複作業的工作, 一定會有 <code>莫非</code> 的出現.
還好關於申請 ssl 證書有人推出了自動化服務, 特別它是免費的.
<code>Let&#8217;s Encrypt</code> 在 2015 年底正式提供這個服務. 所以我們的目標便是將兩者整合在一起, 期快樂無比.</p>
</div>
<div class="paragraph">
<p><a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a> 首頁大大寫著
<code>Let’s Encrypt is a free, automated, and open Certificate Authority.</code>
不知你最先注意到的是 <code>free</code>, <code>open</code> 還是 <code>automated</code> .
free 跟 open 應該是這個網路網路時代的顯學. 但很多人沒注意到的是 <code>automated(自動化)</code> 才是幕後功臣.</p>
</div>
<div class="paragraph">
<p>然而畢竟是自動化, 總不能要自己還要複製貼上的輸入資料吧. 所以, 要讓你的 <code>Let&#8217;s Encrypt</code> 申請自動化,
首先你的 Web Server 要支援
<a href="https://github.com/ietf-wg-acme/acme">Automatic Certificate Management Environment</a> (ACME 目前還是草稿階段).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,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" alt="Diagram" width="491" height="251">
</div>
</div>
<div class="paragraph">
<p>而現在要讓 <code>HAProxy</code> 支援 <code>ACME</code>, 但(臣妾)辦不到(目前). 或許你可以利用崁入式語言
<code>Lua</code> 為他寫一個支援 <code>ACME</code> 的程式. 使用
<code>haproxy -vv|grep Lua</code> 檢查你的 <code>HAproxy</code> 是否支援 <code>Lua</code>.
不想如此麻煩, 就必須另外使用工具.
<code>Let&#8217;s Encrypt</code> 推薦的首選工具是 <a href="https://certbot.eff.org"><code>certbot</code></a>.</p>
</div>
<div class="paragraph">
<p>現在我們要借用 <code>certbot</code> 來達成 <code>HAProxy</code> 支援 <code>ACME</code> 的功能.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,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" alt="Diagram" width="768" height="245">
</div>
</div>
<div class="paragraph">
<p>首先下載 <code>certbot</code>, 你可以簡單的使用 <code>sudo apt-get install certbot</code> 下載安裝現有的封裝版本.
或註冊 <code>certbot</code> 的個人套件庫取得最新的版本.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo apt-get update
$ sudo apt-get -y install software-properties-common
$ sudo add-apt-repository ppa:certbot/certbot
$ sudo apt-get update
$ sudo apt-get -y install certbot</code></pre>
</div>
</div>
<div class="paragraph">
<p>理所當然的你應該有一個合法的註冊網域和正在執行的 <code>HAProxy</code> 伺服器.</p>
</div>
<div class="sect1">
<h2 id="_要求新授權證書">要求新授權證書</h2>
<div class="sectionbody">
<div class="paragraph">
<p>因為是要求新授權, 理所當然認為你現在沒有證書, 也就沒有辦法使用 <code>https</code>,
所以 <code>Let&#8217;s Encrypt</code> 是透過 <code>port:80</code> 與 Client 溝通.
我們可以將 <code>HAProxy</code> 設定成將透過 <code>port:80</code> 進來且路徑是
 <code>/.well-known/acme-challenge/</code> 的 <code>request</code> 傳給 <code>certbot</code>.
 並選擇一個空的 <code>port number</code> 給 <code>certbot</code> 使用. 這裡使用的是 <code>port:8888</code>.</p>
</div>
<div class="listingblock">
<div class="title">/etc/haproxy/haproxy.cfg</div>
<div class="content">
<pre class="highlight"><code class="language-config" data-lang="config">frontend http
    bind    *:80

    acl acme path_beg /.well-known/acme-challenge/
    use_backend acme-backend if acme

backend acme-backend
    server certbot 127.0.0.1:16523</code></pre>
</div>
</div>
<div class="paragraph">
<p>改好 <code>HAProxy</code> 的設定檔後, 重新啟動 <code>HAProxy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo certbot certonly --standalone -d your.domain.name \
  --non-interactive --agree-tos \
  --email yourAdmin@your.domain.name \
  --http-01-port=16523</pre>
</div>
</div>
<div class="paragraph">
<p>這裡的 <code>--http-01-port=16523</code> 要跟
<code>HAProxy</code> 設定檔中 <code>server certbot 127.0.0.1:16523</code> 的 <code>port</code> 相同.</p>
</div>
<div class="paragraph">
<p>成功會出現</p>
</div>
<div class="listingblock">
<div class="content">
<pre>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/your.domain.name/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/your.domain.name/privkey.pem
   Your cert will expire on yyyy-mm-dd. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   "certbot renew"</pre>
</div>
</div>
<div class="paragraph">
<p>之類的說明文字. 如果有出現錯誤, 請再依說明處理.</p>
</div>
<div class="listingblock">
<div class="title">e.q.</div>
<div class="content">
<pre>IMPORTANT NOTES:
 - The following errors were reported by the server:</pre>
</div>
</div>
<div class="paragraph">
<p>將產生的兩個檔案 <code>/etc/letsencrypt/live/your.domain.name/fullchain.pem</code> 和
<code>/etc/letsencrypt/live/your.domain.name/privkey.pem</code> 合併成一個檔案.
要注意合併的先後順序.</p>
</div>
<div class="listingblock">
<div class="title">e.q./etc/ssl/your.domain.name/your.domain.name.pem</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo mkdir -p /etc/ssl/

$ sudo cat /etc/letsencrypt/live/your.domain.name/fullchain.pem \
/etc/letsencrypt/live/your.domain.name/privkey.pem \
| sudo tee /etc/ssl/your.domain.name/your.domain.name.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>將該檔案設給 <code>HAProxy</code> 的 <code>ssl crt</code>.</p>
</div>
<div class="paragraph">
<p>因為現有有了 ssl 證書, 所以我們可以將 <code>HAProxy</code> 監聽 <code>port 443</code> 的設定加上.
同時現在也可以對 <code>Let&#8217;s Encrypt</code> 要求 <code>renew</code> 了. 當然因為是 <code>renew</code> 所以
<code>ACME</code> 是透過 <code>443 port</code> 來要求的.</p>
</div>
<div class="listingblock">
<div class="title">/etc/haproxy/haproxy.cfg</div>
<div class="content">
<pre class="highlight"><code class="language-config" data-lang="config">frontend https
    bind    *:443 ssl crt /etc/ssl/your.domain.name/your.domain.name.pem

    acl acme path_beg /.well-known/acme-challenge/
    use_backend acme-backend if acme</code></pre>
</div>
</div>
<div class="paragraph">
<p>改好 <code>HAProxy</code> 的設定檔後, 重新啟動 <code>HAProxy</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_要求更新授權證書">要求更新授權證書</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>certbot</code> 要求更新證書是很簡單的. 只要執行 <code>certbot renew</code>,
其他參數都會延續之前要求新授權證書時的設定.
但因為我們現在是透過 <code>HAProxy</code> 來轉給 <code>certbot</code>, 所以跟之前監聽 <code>port 443</code> 一樣,
必須把 <code>443 port</code> 下, 路徑是 <code>/.well-known/acme-challenge/</code> 轉給 <code>certbot</code> 處理.</p>
</div>
<div class="paragraph">
<p><code>Let&#8217;s Encrypt</code> 發的證書, 有效是 <code>90</code> 天, 而 <code>certbot</code> 並不是系統常駐程式,
而是做完工作就結束了. 所以我們必須在到期前, 再執行一次 <code>certbot renew</code>, 取得新證書,
並讓 <code>HAProxy</code> 載入新證書, 才不會過期.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo /usr/bin/certbot renew
  --force-renewal \ // <b class="conum">(1)</b>
  --tls-sni-01-port=16523 \ //<b class="conum">(2)</b>
  --renew-hook &lt;renew 後要執行 service haproxy reload&gt; // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>--force-renewal</code> 要求強迫更新證書, 提前強迫更新證書可以避免有證書斷層.</p>
</li>
<li>
<p><code>--tls-sni-01-port=&lt;port&gt;</code> 指示 <code>certbot</code> 在 <code>HAProxy</code> 導過來的 port 工作.</p>
</li>
<li>
<p><code>--renew-hook</code> 指示當 <code>renew</code> 成功後要執行的 <code>script</code>. 也就是合併檔案, 重新啟動 <code>HAProxy</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>同樣的將產生的兩個檔案合併, 然後重新啟動 <code>HAProxy</code>.</p>
</div>
<div class="paragraph">
<p>最後將上述指令設定給 <code>crontab</code> 來定時執行, 即可.
例如, 在每個月的1號凌晨1點執行 <code>renew.sh</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-crontab" data-lang="crontab">*m h dom mon dow   command
0 1 1 * * renew.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>crontab renew</code> 成功後要執行的 <code>script</code>.</p>
</div>
<div class="listingblock">
<div class="title">hook.sh</div>
<div class="content">
<pre>domain="api.accunix.net"

fullchain="/etc/letsencrypt/live/${domain}/fullchain.pem"
privkey="/etc/letsencrypt/live/${domain}/privkey.pem"
target="/etc/ssl/${domain}/${domain}.pem"

if sudo [ -f ${fullchain} ] &amp;&amp; sudo [ -f ${privkey} ]; then
    dir="/etc/ssl/${domain}"
    if sudo [ ! -d ${dir} ]; then
        sudo mkdir -p ${dir}
    fi
    sudo cat ${fullchain} ${privkey} | sudo tee ${target}

    sudo service haproxy reload
fi</pre>
</div>
</div>
<div class="paragraph">
<p><code>crontab</code> 要執行的 <code>script</code>.</p>
</div>
<div class="listingblock">
<div class="title">renew.sh</div>
<div class="content">
<pre>#!/bin/bash

cwd=$(cd `dirname $0`; pwd -P)

port="16523"
hook="${cwd}/hook.sh"

sudo /usr/bin/certbot renew --force-renewal --tls-sni-01-port=${port} --renew-hook ${hook}</pre>
</div>
</div>
</div>
</div>
    </section>
  </article>

  <div class="row li-author">
    <div class="sixteen columns">
        閱讀在雲端 <img id="qrcode"
        src="https://chart.apis.google.com/chart?cht=qr&chs=120x120&chl=%2finstall-haproxy-lets-encrypt%2f"/>
    </div>
</div>


  <div class="row li-pagination">
    <div class="eight columns">
      <div class="li-pagination-previous">
        
        <a href="/install-puppeteer/"> 在 Linux 上安裝 Puppeteer</a>
        &lt;&lt;
        
      </div>
    </div>
    <div class="eight columns">
      <div class="li-pagination-next">
        
        &gt;&gt;
        <a href="/install-ubuntu-nginx-fpm-mysql/"> 安裝 LEMP 開發環境</a>
        
      </div>
    </div>
  </div>


  </article>
  <aside class="side">
    
    
    
  </aside>
  <div class="ad">
    
    
    
  </div>
  <footer class="footer">
    &copy; 2021. All rights reserved. 
  </footer>
</body>

</html>
