<!DOCTYPE html>
<html xmlns="//www.w3.org/1999/xhtml" lang="zh-Hant-TW">
    <head>

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <title>Install Haproxy Lets Encrypt &middot; The Issue of the Day Before</title>
        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-6102554-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-6102554-1');
</script>


        <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600'>
        <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosanstc.css"/>
        <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/tomorrow.min.css">
        <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="/css/asciidoctor-default.css" />
        <link rel="stylesheet" href="/css/themes.css" />
        <link rel="stylesheet" href="/css/liquorice.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="/apple-icon-144x144.png" sizes="144x144" />
        <link rel="alternate" href="/" type="application/rss+xml" title="The Issue of the Day Before" />
    </head>
    <body class="li-body">

<header class="li-page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="/">The Issue of the Day Before</a></div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row gridpaper">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">讓 HAProxy 也可以 Let&#39;s Encrypt</h1>
                        <span class="li-article-taxonomies">
                            

                            
                        </span>
                        
                        <time class="li-article-date">2018-08-23</time>
                    </header>
                    <section>
                        <div class="paragraph">
<p>越來越多的服務要求使用 <code>https</code>, 在網路上混的 <code>HAProxy</code> 當然也要聲援一下.
<code>HAProxy</code> 自從 <code>1.5</code> 版後就支援 <code>SSL</code>. 但每次到期要手動申請 <code>renew</code> 也是一項不人性的作業.
不出意外, 只要有這種長時間後才要重複作業的工作, 一定會有 <code>莫非</code> 的出現.
還好關於申請 ssl 證書有人推出了自動化服務, 特別它是免費的.
<code>Let&#8217;s Encrypt</code> 在 2015 年底正式提供這個服務. 所以我們的目標便是將兩者整合在一起, 期快樂無比.
</p>
</div>
<div class="paragraph">
<p><a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a> 首頁大大寫著
<code>Let’s Encrypt is a free, automated, and open Certificate Authority.</code>
不知你最先注意到的是 <code>free</code>, <code>open</code> 還是 <code>automated</code> .
free 跟 open 應該是這個網路網路時代的顯學. 但很多人沒注意到的是 <code>automated(自動化)</code> 才是幕後功臣.</p>
</div>
<div class="paragraph">
<p>然而畢竟是自動化, 總不能要自己還要複製貼上的輸入資料吧. 所以, 要讓你的 <code>Let&#8217;s Encrypt</code> 申請自動化,
首先你的 Web Server 要支援
<a href="https://github.com/ietf-wg-acme/acme">Automatic Certificate Management Environment</a> (ACME 目前還是草稿階段).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,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" alt="diag 1d337c3ba1aa00fe134930ca74d12cc8" width="491" height="251">
</div>
</div>
<div class="paragraph">
<p>而現在要讓 <code>HAProxy</code> 支援 <code>ACME</code>, 但(臣妾)辦不到(目前). 或許你可以利用崁入式語言
<code>Lua</code> 為他寫一個支援 <code>ACME</code> 的程式. 使用
<code>haproxy -vv|grep Lua</code> 檢查你的 <code>HAproxy</code> 是否支援 <code>Lua</code>.
不想如此麻煩, 就必須另外使用工具.
<code>Let&#8217;s Encrypt</code> 推薦的首選工具是 <a href="https://certbot.eff.org"><code>certbot</code></a>.</p>
</div>
<div class="paragraph">
<p>現在我們要借用 <code>certbot</code> 來達成 <code>HAProxy</code> 支援 <code>ACME</code> 的功能.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,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" alt="diag df79dc3b794d560106924e7b52ab3521" width="760" height="245">
</div>
</div>
<div class="paragraph">
<p>首先下載 <code>certbot</code>, 你可以簡單的使用 <code>sudo apt-get install certbot</code> 下載安裝現有的封裝版本.
或註冊 <code>certbot</code> 的個人套件庫取得最新的版本.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo apt-get update
$ sudo apt-get -y install software-properties-common
$ sudo add-apt-repository ppa:certbot/certbot
$ sudo apt-get update
$ sudo apt-get -y install certbot</code></pre>
</div>
</div>
<div class="paragraph">
<p>理所當然的你應該有一個合法的註冊網域和正在執行的 <code>HAProxy</code> 伺服器.</p>
</div>
<div class="sect1">
<h2 id="_要求新授權證書">要求新授權證書</h2>
<div class="sectionbody">
<div class="paragraph">
<p>因為是要求新授權, 理所當然認為你現在沒有證書, 也就沒有辦法使用 <code>https</code>,
所以 <code>Let&#8217;s Encrypt</code> 是透過 <code>port:80</code> 與 Client 溝通.
我們可以將 <code>HAProxy</code> 設定成將透過 <code>port:80</code> 進來且路徑是
 <code>/.well-known/acme-challenge/</code> 的 <code>request</code> 傳給 <code>certbot</code>.
 並選擇一個空的 <code>port number</code> 給 <code>certbot</code> 使用. 這裡使用的是 <code>port:8888</code>.</p>
</div>
<div class="listingblock">
<div class="title">/etc/haproxy/haproxy.cfg</div>
<div class="content">
<pre class="highlight"><code class="language-config" data-lang="config">frontend http
    bind    *:80

    acl acme path_beg /.well-known/acme-challenge/
    use_backend acme-backend if acme

backend acme-backend
    server certbot 127.0.0.1:16523</code></pre>
</div>
</div>
<div class="paragraph">
<p>改好 <code>HAProxy</code> 的設定檔後, 重新啟動 <code>HAProxy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo certbot certonly --standalone -d your.domain.name \
  --non-interactive --agree-tos \
  --email yourAdmin@your.domain.name \
  --http-01-port=16523</pre>
</div>
</div>
<div class="paragraph">
<p>這裡的 <code>--http-01-port=16523</code> 要跟
<code>HAProxy</code> 設定檔中 <code>server certbot 127.0.0.1:16523</code> 的 <code>port</code> 相同.</p>
</div>
<div class="paragraph">
<p>成功會出現</p>
</div>
<div class="listingblock">
<div class="content">
<pre>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/your.domain.name/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/your.domain.name/privkey.pem
   Your cert will expire on yyyy-mm-dd. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   "certbot renew"</pre>
</div>
</div>
<div class="paragraph">
<p>之類的說明文字. 如果有出現錯誤, 請再依說明處理.</p>
</div>
<div class="listingblock">
<div class="title">e.q.</div>
<div class="content">
<pre>IMPORTANT NOTES:
 - The following errors were reported by the server:</pre>
</div>
</div>
<div class="paragraph">
<p>將產生的兩個檔案 <code>/etc/letsencrypt/live/your.domain.name/fullchain.pem</code> 和
<code>/etc/letsencrypt/live/your.domain.name/privkey.pem</code> 合併成一個檔案.
要注意合併的先後順序.</p>
</div>
<div class="listingblock">
<div class="title">e.q./etc/ssl/your.domain.name/your.domain.name.pem</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo mkdir -p /etc/ssl/

$ sudo cat /etc/letsencrypt/live/your.domain.name/fullchain.pem \
/etc/letsencrypt/live/your.domain.name/privkey.pem \
| sudo tee /etc/ssl/your.domain.name/your.domain.name.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>將該檔案設給 <code>HAProxy</code> 的 <code>ssl crt</code>.</p>
</div>
<div class="paragraph">
<p>因為現有有了 ssl 證書, 所以我們可以將 <code>HAProxy</code> 監聽 <code>port 443</code> 的設定加上.
同時現在也可以對 <code>Let&#8217;s Encrypt</code> 要求 <code>renew</code> 了. 當然因為是 <code>renew</code> 所以
<code>ACME</code> 是透過 <code>443 port</code> 來要求的.</p>
</div>
<div class="listingblock">
<div class="title">/etc/haproxy/haproxy.cfg</div>
<div class="content">
<pre class="highlight"><code class="language-config" data-lang="config">frontend https
    bind    *:443 ssl crt /etc/ssl/your.domain.name/your.domain.name.pem

    acl acme path_beg /.well-known/acme-challenge/
    use_backend acme-backend if acme</code></pre>
</div>
</div>
<div class="paragraph">
<p>改好 <code>HAProxy</code> 的設定檔後, 重新啟動 <code>HAProxy</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_要求更新授權證書">要求更新授權證書</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>certbot</code> 要求更新證書是很簡單的. 只要執行 <code>certbot renew</code>,
其他參數都會延續之前要求新授權證書時的設定.
但因為我們現在是透過 <code>HAProxy</code> 來轉給 <code>certbot</code>, 所以跟之前監聽 <code>port 443</code> 一樣,
必須把 <code>443 port</code> 下, 路徑是 <code>/.well-known/acme-challenge/</code> 轉給 <code>certbot</code> 處理.</p>
</div>
<div class="paragraph">
<p><code>Let&#8217;s Encrypt</code> 發的證書, 有效是 <code>90</code> 天, 而 <code>certbot</code> 並不是系統常駐程式,
而是做完工作就結束了. 所以我們必須在到期前, 再執行一次 <code>certbot renew</code>, 取得新證書,
並讓 <code>HAProxy</code> 載入新證書, 才不會過期.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ sudo /usr/bin/certbot renew
  --force-renewal \ <b class="conum">(1)</b>
  --tls-sni-01-port=16523 \ <b class="conum">(2)</b>
  --renew-hook &lt;renew 後要執行 service haproxy reload&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>--force-renewal</code> 要求強迫更新證書, 提前強迫更新證書可以避免有證書斷層.</p>
</li>
<li>
<p><code>--tls-sni-01-port=&lt;port&gt;</code> 指示 <code>certbot</code> 在 <code>HAProxy</code> 導過來的 port 工作.</p>
</li>
<li>
<p><code>--renew-hook</code> 指示當 <code>renew</code> 成功後要執行的 <code>script</code>. 也就是合併檔案, 重新啟動 <code>HAProxy</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>同樣的將產生的兩個檔案合併, 然後重新啟動 <code>HAProxy</code>.</p>
</div>
<div class="paragraph">
<p>最後將上述指令設定給 <code>crontab</code> 來定時執行, 即可.
例如, 在每個月的1號凌晨1點執行 <code>renew.sh</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-crontab" data-lang="crontab">*m h dom mon dow   command
0 1 1 * * renew.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>crontab renew</code> 成功後要執行的 <code>script</code>.</p>
</div>
<div class="listingblock">
<div class="title">hook.sh</div>
<div class="content">
<pre>domain="api.accunix.net"

fullchain="/etc/letsencrypt/live/${domain}/fullchain.pem"
privkey="/etc/letsencrypt/live/${domain}/privkey.pem"
target="/etc/ssl/${domain}/${domain}.pem"

if sudo [ -f ${fullchain} ] &amp;&amp; sudo [ -f ${privkey} ]; then
    dir="/etc/ssl/${domain}"
    if sudo [ ! -d ${dir} ]; then
        sudo mkdir -p ${dir}
    fi
    sudo cat ${fullchain} ${privkey} | sudo tee ${target}

    sudo service haproxy reload
fi</pre>
</div>
</div>
<div class="paragraph">
<p><code>crontab</code> 要執行的 <code>script</code>.</p>
</div>
<div class="listingblock">
<div class="title">renew.sh</div>
<div class="content">
<pre>#!/bin/bash

cwd=$(cd `dirname $0`; pwd -P)

port="16523"
hook="${cwd}/hook.sh"

sudo /usr/bin/certbot renew --force-renewal --tls-sni-01-port=${port} --renew-hook ${hook}</pre>
</div>
</div>
</div>
</div>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        閱讀在雲端 <img id="qrcode"
        src="https://chart.apis.google.com/chart?cht=qr&chs=120x120&chl=%2fpost%2finstall-haproxy-lets-encrypt%2f"/>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        <a href="/post/install-ubuntu-nginx-fpm-mysql/"> 安裝 LEMP 開發環境</a>
                        &lt;&lt; 
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        &gt;&gt;
                        <a href="/post/install-puppeteer/"> 在 Linux 上安裝 Puppeteer</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2018. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                </div>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript">
    <!--
    function toggle(id) {
        var e = document.getElementById(id);
        e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
    }
    
    </script>
    </body>
</html>

